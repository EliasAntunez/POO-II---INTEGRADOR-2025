<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/base :: layout(title=~{::title}, content=~{::content})}">
<head>
    <title>Confirmar Pago</title>
</head>
<body>
    <th:block th:fragment="content">
        <style>
            .resumen-pago {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 10px;
                padding: 2rem;
                box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            }
            .monto-destacado {
                font-size: 3rem;
                font-weight: bold;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
        </style>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a th:href="@{/facturas/listar}">Facturas</a>
                </li>
                <li class="breadcrumb-item">
                    <a th:href="@{/facturas/{id}(id=${factura.id})}"
                        th:text="${'Factura ' + factura.numeroFactura}">
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Confirmar Pago</li>
            </ol>
        </nav>

        <div class="container" style="max-width: 800px;">
            
            <!-- Título -->
            <div class="text-center mb-4">
                <h1 class="h2">
                    <i class="bi bi-cash-coin"></i>
                    Confirmar Pago Total
                </h1>
                <p class="text-muted">
                    Está a punto de registrar el pago total de la siguiente factura
                </p>
            </div>

            <!-- Resumen de Pago -->
            <div class="resumen-pago mb-4">
                <div class="text-center">
                    <h3 class="mb-3">
                        <i class="bi bi-receipt"></i>
                        Factura <span th:text="${factura.numeroFactura}"></span>
                    </h3>
                    
                    <div class="mb-3">
                        <div class="text-uppercase mb-2" style="font-size: 1.1rem;">
                            Monto Total a Pagar
                        </div>
                        <div class="monto-destacado"
                            th:text="${'$ ' + #numbers.formatDecimal(factura.montoTotal, 1, 'POINT', 2, 'COMMA')}">
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-6">
                            <strong>Cliente:</strong><br>
                            <span th:text="${factura.cliente.nombre + ' ' + factura.cliente.apellido}"></span>
                        </div>
                        <div class="col-6">
                            <strong>Fecha Emisión:</strong><br>
                            <span th:text="${#temporals.format(factura.fechaEmision, 'dd/MM/yyyy')}"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desglose -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-calculator"></i> Desglose del Pago
                    </h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-6">Subtotal (sin IVA):</dt>
                        <dd class="col-sm-6 text-end"
                            th:text="${'$ ' + #numbers.formatDecimal(factura.subtotal, 1, 'POINT', 2, 'COMMA')}">
                        </dd>
                        
                        <dt class="col-sm-6">Total IVA:</dt>
                        <dd class="col-sm-6 text-end"
                            th:text="${'$ ' + #numbers.formatDecimal(factura.totalIva, 1, 'POINT', 2, 'COMMA')}">
                        </dd>
                        
                        <dt class="col-sm-6 border-top pt-2">
                            <strong>TOTAL A PAGAR:</strong>
                        </dt>
                        <dd class="col-sm-6 text-end border-top pt-2">
                            <strong class="fs-4 text-success"
                                    th:text="${'$ ' + #numbers.formatDecimal(factura.montoTotal, 1, 'POINT', 2, 'COMMA')}">
                            </strong>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Servicios Incluidos -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-list-check"></i> Servicios Incluidos
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:each="detalle : ${factura.detalles}">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong th:text="${detalle.descripcion}"></strong>
                                    <br>
                                    <small class="text-muted">
                                        Cantidad: <span th:text="${detalle.cantidad}"></span> ×
                                        <span th:text="${'$ ' + #numbers.formatDecimal(detalle.precioUnitario, 1, 'POINT', 2, 'COMMA')}"></span>
                                    </small>
                                </div>
                                <div class="text-end">
                                    <strong th:text="${'$ ' + #numbers.formatDecimal(detalle.total, 1, 'POINT', 2, 'COMMA')}">
                                    </strong>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Formulario de Confirmación -->
            <div class="card border-warning mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="bi bi-exclamation-triangle"></i> Confirmación Requerida
                    </h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/facturas/{id}/pago-total(id=${factura.id})}" method="post">
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <strong>Importante:</strong> Al confirmar, se registrará el pago total de esta factura
                            y su estado cambiará a <strong>PAGADA</strong>. Esta acción no se puede deshacer.
                        </div>

                        <div class="mb-3">
                            <label for="usuarioPago" class="form-label">
                                Usuario que registra el pago:
                            </label>
                            <input type="text"
                                class="form-control"
                                id="usuarioPago"
                                name="usuarioPago"
                                value="Administrador"
                                required
                                maxlength="100">
                            <small class="text-muted">
                                Este nombre quedará registrado en la factura como quien realizó el pago
                            </small>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
                            <a th:href="@{/facturas/{id}(id=${factura.id})}"
                                class="btn btn-outline-secondary btn-lg">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-check-circle-fill"></i>
                                Confirmar Pago de factura
                                <strong th:text="${'$ ' + #numbers.formatDecimal(factura.montoTotal, 1, 'POINT', 2, 'COMMA')}">
                                </strong>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

    </th:block>
</body>
</html>